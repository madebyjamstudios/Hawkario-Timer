<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self'; script-src 'self';" />
  <title>Ninja Timer — Control</title>
  <link rel="stylesheet" href="../shared/fonts.css" />
  <link rel="stylesheet" href="../shared/base.css" />
  <link rel="stylesheet" href="control.css" />
</head>
<body>
  <header>
    <div class="hawk-icon" aria-hidden="true">
      <!-- Dark mode icon (light gray ring) -->
      <svg class="icon-dark" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2c4.8 0 8.5 3.7 8.5 8.5 0 2.6-1.1 4.9-2.9 6.5-.5.5-1.2.5-1.7 0-.4-.4-.4-1 0-1.5 1.3-1.2 2.1-2.9 2.1-4.8 0-3.8-3.1-6.9-6.9-6.9-2.5 0-4.6 1.3-5.8 3.3-.3.5-1 .6-1.5.3-.5-.3-.6-1-.3-1.5C4.9 3.6 8.2 2 12 2z" fill="#e0e0e0"/>
        <path d="M6.5 9.5c3.1-1.1 6.4 0 8.2 2.7.6.9 1.7 1.3 2.7.9 0 0-1.5 3.8-6.2 5.2-3.4 1-6.6.1-8.6-1.1 0 0 2.1-.5 3.4-1.7 1.1-1 1.4-2.1 1.6-3.3.1-.9-.3-1.8-1.1-2.4z" fill="#e64a19"/>
        <circle cx="15.2" cy="10.8" r="1.2" fill="#ffeb3b"/>
      </svg>
      <!-- Light mode icon (dark charcoal ring) -->
      <svg class="icon-light" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2c4.8 0 8.5 3.7 8.5 8.5 0 2.6-1.1 4.9-2.9 6.5-.5.5-1.2.5-1.7 0-.4-.4-.4-1 0-1.5 1.3-1.2 2.1-2.9 2.1-4.8 0-3.8-3.1-6.9-6.9-6.9-2.5 0-4.6 1.3-5.8 3.3-.3.5-1 .6-1.5.3-.5-.3-.6-1-.3-1.5C4.9 3.6 8.2 2 12 2z" fill="#1d1d1f"/>
        <path d="M6.5 9.5c3.1-1.1 6.4 0 8.2 2.7.6.9 1.7 1.3 2.7.9 0 0-1.5 3.8-6.2 5.2-3.4 1-6.6.1-8.6-1.1 0 0 2.1-.5 3.4-1.7 1.1-1 1.4-2.1 1.6-3.3.1-.9-.3-1.8-1.1-2.4z" fill="#e64a19"/>
        <circle cx="15.2" cy="10.8" r="1.2" fill="#ffeb3b"/>
      </svg>
    </div>
    <h1 class="brand">Ninja Timer</h1>
    <div class="header-spacer"></div>
    <button id="openOutput" class="header-btn output-btn" title="Open Output Window">Output</button>
    <button id="appSettingsBtn" class="header-settings-btn" title="Settings">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
    </button>
  </header>

  <main class="main-compact">
    <!-- Live Preview (top, resizable) -->
    <div id="previewSection" class="preview-section">
      <div id="previewWrapper" class="live-preview-wrapper">
        <div id="livePreview" class="live-preview">
          <div id="livePreviewContentBox" class="content-box">
            <div class="timer-section">
              <div class="timer-box">
                <div id="livePreviewTimer" class="timer-preview">10:00</div>
              </div>
              <div class="tod-box">
                <div id="livePreviewToD" class="tod-preview"></div>
              </div>
            </div>
            <div class="message-section">
              <div id="livePreviewMessage" class="message-preview"></div>
            </div>
          </div>
        </div>
      </div>
      <div id="previewResizeHandle" class="preview-resize-handle">
        <div class="resize-grip"></div>
      </div>
    </div>

    <!-- Progress Bar (Interactive with seek functionality) -->
    <div id="timerProgressContainer" class="timer-progress-container">
      <!-- Interactive track -->
      <div class="progress-track" id="progressTrack">
        <!-- Inner clip area for fill and warning zones -->
        <div class="progress-clip">
          <!-- Warning zone backgrounds (yellow/orange) -->
          <div id="warningZones" class="warning-zones"></div>
          <!-- Elapsed fill -->
          <div id="progressFill" class="progress-fill"></div>
        </div>

        <!-- Time segment dividers -->
        <div id="progressSegments" class="progress-segments"></div>

        <!-- Current position indicator -->
        <div id="progressIndicator" class="progress-indicator"></div>

        <!-- Hover seek line (follows mouse) -->
        <div id="seekLine" class="seek-line hidden"></div>

        <!-- Hover time tooltip -->
        <div id="seekTooltip" class="seek-tooltip hidden">00:00</div>
      </div>
    </div>

    <!-- Control Buttons -->
    <div class="utility-bar">
      <button id="flashBtn" class="flash-btn">
        <svg class="flash-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        <span class="flash-text">Flash</span>
      </button>
      <button id="blackoutBtn" class="blackout-btn">
        <span class="blackout-indicator"></span>
        Blackout
      </button>
      <div class="utility-spacer"></div>
      <button id="profileBtn" class="profile-btn">
        <span id="profileColorDot" class="profile-color-dot"></span>
        <span id="profileName">Default</span>
        <svg class="profile-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>
    </div>

    <!-- Tab Content Container -->
    <div class="tab-content-container">
      <!-- Timers Tab (default) -->
      <div id="timersTab" class="tab-content active">
        <div class="preset-list-container">
          <div id="presetList" class="preset-list"></div>
        </div>
      </div>

      <!-- Messages Tab -->
      <div id="messagesTab" class="tab-content">
        <div class="message-list-container">
          <div id="messageList" class="message-list"></div>
        </div>
      </div>
    </div>

    <!-- Bottom Bar: Tab Icons + Add Timer -->
    <div class="bottom-bar">
      <button id="timersTabBtn" class="tab-icon-btn active" data-tab="timers" title="Timers">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        <span class="tab-badge" id="timersBadge"></span>
      </button>
      <button id="addTimer" class="add-timer-btn">+ Add Timer</button>
      <button id="messagesTabBtn" class="tab-icon-btn" data-tab="messages" title="Messages">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <span class="tab-badge" id="messagesBadge"></span>
      </button>
    </div>

    <input id="importFile" type="file" accept="application/json" style="display:none" />
  </main>

  <!-- Settings Modal -->
  <div id="timerModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title-group">
          <h2 id="modalTitle">Edit Timer</h2>
          <button id="modalPopout" class="modal-popout" title="Open in new window">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
          </button>
        </div>
        <button id="modalClose" class="modal-close">&times;</button>
      </div>

      <div class="modal-body">
        <!-- Preview in modal - sticky section with duration controls -->
        <div class="modal-preview-section">
          <div class="modal-preview-wrapper">
            <div id="modalPreview" class="modal-preview">
              <div class="content-box">
                <div class="timer-section">
                  <div class="timer-box">
                    <div id="modalPreviewTimer" class="timer-preview">10:00</div>
                  </div>
                  <div class="tod-box">
                    <div id="modalPreviewToD" class="tod-preview"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Duration controls - now inside sticky section -->
          <div class="duration-controls" id="durationControls">
            <!-- Hours (hidden when format is MM:SS) -->
            <div class="digit-group hours-group" id="hoursGroup">
              <div class="digit-col h0-col" id="h0Col">
                <button type="button" class="digit-btn digit-up" data-digit="h0">▲</button>
                <button type="button" class="digit-btn digit-down" data-digit="h0">▼</button>
              </div>
              <div class="digit-col">
                <button type="button" class="digit-btn digit-up" data-digit="h1">▲</button>
                <button type="button" class="digit-btn digit-down" data-digit="h1">▼</button>
              </div>
              <div class="digit-col">
                <button type="button" class="digit-btn digit-up" data-digit="h2">▲</button>
                <button type="button" class="digit-btn digit-down" data-digit="h2">▼</button>
              </div>
            </div>
            <span class="digit-separator hours-sep">:</span>
            <!-- Minutes -->
            <div class="digit-group minutes-group">
              <div class="digit-col">
                <button type="button" class="digit-btn digit-up" data-digit="m1">▲</button>
                <button type="button" class="digit-btn digit-down" data-digit="m1">▼</button>
              </div>
              <div class="digit-col">
                <button type="button" class="digit-btn digit-up" data-digit="m2">▲</button>
                <button type="button" class="digit-btn digit-down" data-digit="m2">▼</button>
              </div>
            </div>
            <span class="digit-separator minutes-sep">:</span>
            <!-- Seconds -->
            <div class="digit-group seconds-group">
              <div class="digit-col">
                <button type="button" class="digit-btn digit-up" data-digit="s1">▲</button>
                <button type="button" class="digit-btn digit-down" data-digit="s1">▼</button>
              </div>
              <div class="digit-col">
                <button type="button" class="digit-btn digit-up" data-digit="s2">▲</button>
                <button type="button" class="digit-btn digit-down" data-digit="s2">▼</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Tab Bar -->
        <div class="settings-tabs">
          <button class="settings-tab active" data-tab="timer">Timer</button>
          <button class="settings-tab" data-tab="appearance">Appearance</button>
          <button class="settings-tab" data-tab="sound">Sound</button>
          <button class="settings-tab" data-tab="warning">Warnings</button>
        </div>

        <!-- Tab Panels -->
        <div class="settings-tab-panels">
          <!-- Timer Tab -->
          <div class="settings-tab-panel active" data-panel="timer">
            <div class="kv">
              <label for="presetName">Title</label>
              <input id="presetName" type="text" placeholder="Timer 1" />
            </div>
            <div class="kv">
              <label for="mode">Mode</label>
              <select id="mode">
                <option value="countdown">Countdown</option>
                <option value="countup">Count Up</option>
                <option value="tod">Time of Day</option>
                <option value="countdown-tod">C/D + ToD</option>
                <option value="countup-tod">C/U + ToD</option>
              </select>
            </div>
            <div class="kv">
              <label for="startMode">Start</label>
              <select id="startMode">
                <option value="manual">Manual</option>
                <option value="endBy">End By Time</option>
                <option value="startAt">Start At Time</option>
              </select>
            </div>
            <div class="kv hidden" id="targetTimeRow">
              <label for="targetTime">Target Time</label>
              <input id="targetTime" type="datetime-local" />
            </div>
            <div class="kv">
              <label for="format">Format</label>
              <select id="format">
                <option value="HH:MM:SS">HH:MM:SS</option>
                <option value="MM:SS" selected>MM:SS</option>
              </select>
            </div>
            <div class="kv" id="durationRow">
              <label for="duration">Duration</label>
              <input id="duration" type="text" class="time-input duration-input" value="00:10:00" maxlength="10" placeholder="e.g. 530 or 5:30" />
            </div>
            <div class="kv" id="allowOvertimeRow">
              <label for="allowOvertime">Overtime</label>
              <input type="checkbox" id="allowOvertime" class="toggle-switch" checked />
            </div>
          </div>

          <!-- Appearance Tab -->
          <div class="settings-tab-panel" data-panel="appearance">
            <!-- Apple-style Font Picker -->
            <div class="font-picker-section">
              <label class="font-picker-label">Font</label>
              <div id="fontPicker" class="font-picker">
                <!-- Font options populated by JavaScript -->
              </div>
              <input type="hidden" id="fontFamily" value="Inter" />
            </div>
            <div class="kv">
              <label for="fontWeight">Weight</label>
              <select id="fontWeight">
                <option value="300">Light</option>
                <option value="400">Regular</option>
                <option value="500">Medium</option>
                <option value="600">Semi Bold</option>
                <option value="700" selected>Bold</option>
                <option value="800">Extra Bold</option>
                <option value="900">Black</option>
              </select>
            </div>
            <div class="kv">
              <label for="fontColor">Text Color</label>
              <input id="fontColor" type="color" value="#ffffff" />
            </div>
            <div class="kv kv-inline">
              <label>Stroke</label>
              <div class="inline-controls">
                <input id="strokeWidth" type="number" min="0" max="20" step="1" value="0" class="number-stepper" />
                <span class="unit-label">px</span>
                <input id="strokeColor" type="color" value="#000000" />
              </div>
            </div>
            <div class="kv kv-inline">
              <label>Shadow</label>
              <div class="inline-controls">
                <input id="shadowSize" type="number" min="0" max="50" step="1" value="0" class="number-stepper" />
                <span class="unit-label">px</span>
                <input id="shadowColor" type="color" value="#000000" />
              </div>
            </div>
            <div class="kv">
              <label for="bgColor">Background</label>
              <input id="bgColor" type="color" value="#000000" />
            </div>
          </div>

          <!-- Sound Tab -->
          <div class="settings-tab-panel" data-panel="sound">
            <div class="kv">
              <label for="soundEnd">End sound</label>
              <div class="sound-select-row">
                <select id="soundEnd">
                  <option value="none" selected>None</option>
                  <option value="chime">Chime</option>
                  <option value="bell">Bell</option>
                  <option value="alert">Alert</option>
                  <option value="gong">Gong</option>
                  <option value="soft">Soft</option>
                </select>
                <button type="button" id="soundPreview" class="icon-btn preview-btn" title="Preview sound">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="kv" id="volumeRow">
              <label for="soundVolume">Volume</label>
              <div class="volume-slider">
                <svg class="volume-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                </svg>
                <input id="soundVolume" type="range" min="0" max="1" step="0.1" value="0.7" />
                <svg class="volume-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                  <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                  <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                </svg>
              </div>
            </div>
          </div>

          <!-- Warning Tab -->
          <div class="settings-tab-panel" data-panel="warning">
            <div class="kv">
              <label class="warn-label"><span class="warn-dot warn-dot-yellow"></span>Yellow at</label>
              <input id="warnYellowSec" type="text" class="time-input time-input-ms" value="01:00" maxlength="5" />
            </div>
            <div class="kv">
              <label class="warn-label"><span class="warn-dot warn-dot-orange"></span>Orange at</label>
              <input id="warnOrangeSec" type="text" class="time-input time-input-ms" value="00:15" maxlength="5" />
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button id="modalCancel" class="secondary">Cancel</button>
        <button id="modalSave">Save Timer</button>
      </div>
    </div>
  </div>

  <!-- App Settings Modal -->
  <div id="appSettingsModal" class="modal-overlay hidden">
    <div class="modal app-settings-modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button id="appSettingsClose" class="modal-close">&times;</button>
      </div>

      <div class="modal-body">
        <!-- General Section -->
        <div class="settings-section">
          <h3 class="settings-section-title">General</h3>
          <div class="kv">
            <label for="todFormat">Time of Day</label>
            <select id="todFormat">
              <option value="12h">12-hour</option>
              <option value="24h">24-hour</option>
            </select>
          </div>
          <div class="kv">
            <label for="timezone">Timezone</label>
            <select id="timezone">
              <!-- Populated by JavaScript -->
            </select>
          </div>
          <div class="kv">
            <label for="appearance">Appearance</label>
            <select id="appearance">
              <option value="auto">Auto (System)</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
          <div class="kv">
            <label for="confirmDelete">Confirm delete</label>
            <select id="confirmDelete">
              <option value="on">Ask before deleting</option>
              <option value="off">Delete immediately</option>
            </select>
          </div>
        </div>

        <!-- Data Section -->
        <div class="settings-section settings-actions">
          <h3 class="settings-section-title">Data</h3>
          <div class="settings-row">
            <button id="settingsExport" class="secondary">Export Timers</button>
            <button id="settingsImport" class="secondary">Import Timers</button>
          </div>
          <div class="settings-row">
            <button id="restartTutorial" class="secondary">Show Tutorial Again</button>
          </div>
        </div>

        <!-- Window Section -->
        <div class="settings-section">
          <h3 class="settings-section-title">Window</h3>
          <div class="kv">
            <label for="outputOnTop">Output stays on top</label>
            <input type="checkbox" id="outputOnTop" class="toggle-switch" />
          </div>
          <div class="kv">
            <label for="controlOnTop">Control stays on top</label>
            <input type="checkbox" id="controlOnTop" class="toggle-switch" />
          </div>
        </div>

        <!-- Default Timer Settings -->
        <div class="settings-section">
          <h3 class="settings-section-title">New Timer Defaults</h3>
          <p class="settings-hint">Settings applied when creating new timers</p>

          <div class="kv">
            <label for="defaultMode">Mode</label>
            <select id="defaultMode">
              <option value="countdown">Countdown</option>
              <option value="countup">Count Up</option>
              <option value="tod">Time of Day</option>
              <option value="countdown-tod">C/D + ToD</option>
              <option value="countup-tod">C/U + ToD</option>
            </select>
          </div>
          <div class="kv">
            <label>Duration</label>
            <input id="defaultDuration" type="text" class="time-input" value="00:10:00" maxlength="8" />
          </div>
          <div class="kv">
            <label for="defaultFormat">Format</label>
            <select id="defaultFormat">
              <option value="HH:MM:SS">HH:MM:SS</option>
              <option value="MM:SS">MM:SS</option>
            </select>
          </div>
          <div class="kv">
            <label for="defaultSound">End sound</label>
            <select id="defaultSound">
              <option value="none">None</option>
              <option value="chime">Chime</option>
              <option value="bell">Bell</option>
              <option value="alert">Alert</option>
              <option value="gong">Gong</option>
              <option value="soft">Soft</option>
            </select>
          </div>
          <div class="kv">
            <label for="defaultAllowOvertime">Overtime</label>
            <input type="checkbox" id="defaultAllowOvertime" class="toggle-switch" checked />
          </div>
          <div class="kv">
            <label for="defaultSoundVolume">Sound Volume</label>
            <div class="volume-slider">
              <svg class="volume-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
              </svg>
              <input id="defaultSoundVolume" type="range" min="0" max="1" step="0.1" value="0.7" />
              <svg class="volume-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
              </svg>
            </div>
          </div>

          <h4 class="settings-subsection-title">Appearance</h4>
          <div class="kv">
            <label for="defaultFontFamily">Font</label>
            <select id="defaultFontFamily">
              <option value="Inter">Inter - Modern & Clean</option>
              <option value="Roboto">Roboto - Versatile</option>
              <option value="JetBrains Mono">JetBrains Mono - Monospace</option>
              <option value="Oswald">Oswald - Bold Condensed</option>
              <option value="Bebas Neue">Bebas Neue - Classic Display</option>
              <option value="Orbitron">Orbitron - Futuristic</option>
              <option value="Teko">Teko - Modern Condensed</option>
              <option value="Share Tech Mono">Share Tech Mono - Digital</option>
            </select>
          </div>
          <div class="kv">
            <label for="defaultFontWeight">Weight</label>
            <select id="defaultFontWeight">
              <option value="300">Light</option>
              <option value="400">Regular</option>
              <option value="500">Medium</option>
              <option value="600">Semi Bold</option>
              <option value="700" selected>Bold</option>
              <option value="800">Extra Bold</option>
              <option value="900">Black</option>
            </select>
          </div>
          <div class="kv">
            <label for="defaultColor">Text Color</label>
            <input id="defaultColor" type="color" value="#ffffff" />
          </div>
          <div class="kv kv-inline">
            <label>Stroke</label>
            <div class="inline-controls">
              <input id="defaultStrokeWidth" type="number" min="0" max="20" step="1" value="0" class="number-stepper" />
              <span class="unit-label">px</span>
              <input id="defaultStrokeColor" type="color" value="#000000" />
            </div>
          </div>
          <div class="kv kv-inline">
            <label>Shadow</label>
            <div class="inline-controls">
              <input id="defaultShadowSize" type="number" min="0" max="50" step="1" value="0" class="number-stepper" />
              <span class="unit-label">px</span>
              <input id="defaultShadowColor" type="color" value="#000000" />
            </div>
          </div>
          <div class="kv">
            <label for="defaultBgColor">Background</label>
            <input id="defaultBgColor" type="color" value="#000000" />
          </div>

          <h4 class="settings-subsection-title">Warning Colors</h4>
          <div class="kv">
            <label class="warn-label"><span class="warn-dot warn-dot-yellow"></span> Yellow at</label>
            <input id="defaultWarnYellow" type="text" class="time-input time-input-ms" value="01:00" maxlength="5" placeholder="MM:SS" />
          </div>
          <div class="kv">
            <label class="warn-label"><span class="warn-dot warn-dot-orange"></span> Orange at</label>
            <input id="defaultWarnOrange" type="text" class="time-input time-input-ms" value="00:15" maxlength="5" placeholder="MM:SS" />
          </div>
        </div>

        <!-- Display Section -->
        <div class="settings-section">
          <h3 class="settings-section-title">Display</h3>
          <div class="kv">
            <label for="timerZoom">Timer Size</label>
            <select id="timerZoom">
              <option value="75">Small</option>
              <option value="100" selected>Medium</option>
              <option value="125">Large</option>
            </select>
          </div>
          <div class="kv">
            <label>Alignment</label>
            <div id="alignToggle" class="align-toggle-group">
              <button type="button" class="align-toggle-btn" data-align="left" title="Align left">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <line x1="3" y1="6" x2="21" y2="6"/>
                  <line x1="3" y1="12" x2="15" y2="12"/>
                  <line x1="3" y1="18" x2="18" y2="18"/>
                </svg>
              </button>
              <button type="button" class="align-toggle-btn active" data-align="center" title="Align center">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <line x1="3" y1="6" x2="21" y2="6"/>
                  <line x1="6" y1="12" x2="18" y2="12"/>
                  <line x1="4" y1="18" x2="20" y2="18"/>
                </svg>
              </button>
              <button type="button" class="align-toggle-btn" data-align="right" title="Align right">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <line x1="3" y1="6" x2="21" y2="6"/>
                  <line x1="9" y1="12" x2="21" y2="12"/>
                  <line x1="6" y1="18" x2="21" y2="18"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Custom Sounds Section -->
        <div class="settings-section">
          <h3 class="settings-section-title">Custom Sounds</h3>
          <p class="settings-hint">Upload custom sounds for timer alerts</p>
          <div id="customSoundsList" class="custom-sounds-list">
            <!-- Custom sounds will be populated here -->
          </div>
          <button id="addCustomSound" class="secondary">Add Sound...</button>
        </div>

        <!-- OSC Integration Section -->
        <div class="settings-section">
          <h3 class="settings-section-title">OSC Integration</h3>
          <p class="settings-hint">Control Ninja Timer from Companion, Millumin, etc.</p>
          <div class="kv">
            <label for="oscEnabled">OSC Control</label>
            <input type="checkbox" id="oscEnabled" class="toggle-switch" />
          </div>
          <div class="kv" id="oscListenPortRow">
            <label for="oscListenPort">Listen Port</label>
            <input id="oscListenPort" type="number" min="1024" max="65535" value="8000" class="number-input" />
          </div>
          <div class="kv">
            <label for="oscFeedbackEnabled">Send Feedback</label>
            <input type="checkbox" id="oscFeedbackEnabled" class="toggle-switch" />
          </div>
          <div class="kv" id="oscFeedbackHostRow">
            <label for="oscFeedbackHost">Feedback Host</label>
            <input id="oscFeedbackHost" type="text" value="127.0.0.1" class="text-input" />
          </div>
          <div class="kv" id="oscFeedbackPortRow">
            <label for="oscFeedbackPort">Feedback Port</label>
            <input id="oscFeedbackPort" type="number" min="1024" max="65535" value="9000" class="number-input" />
          </div>
          <div id="oscStatus" class="osc-status"></div>
        </div>

        <!-- Updates Section -->
        <div class="settings-section">
          <h3 id="updatesSectionTitle" class="settings-section-title">Updates</h3>
          <div class="update-section">
            <span id="updateStatus"></span>
            <button id="refreshUpdates" class="icon-btn" title="Re-check for updates">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 2v6h-6"></path>
                <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                <path d="M3 22v-6h6"></path>
                <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
              </svg>
            </button>
            <button id="downloadUpdates" class="secondary hidden">Download Updates</button>
            <button id="restartApp" class="secondary hidden">Restart App</button>
          </div>
          <div id="downloadProgress" class="download-progress hidden">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
              <span class="progress-text" id="progressText">0%</span>
            </div>
            <span class="progress-time" id="progressTime"></span>
          </div>
        </div>

        <!-- Feedback Section -->
        <div class="settings-section feedback-section">
          <div class="feedback-header">
            <div class="feedback-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                <path d="M8 10h.01"/>
                <path d="M12 10h.01"/>
                <path d="M16 10h.01"/>
              </svg>
            </div>
            <div class="feedback-text">
              <h3 class="settings-section-title">Send Feedback</h3>
              <p class="feedback-tagline">Ideas, bugs, or just want to say hi? We'd love to hear from you!</p>
            </div>
          </div>
          <div class="feedback-form">
            <div class="feedback-toggles" id="feedbackType">
              <button type="button" class="feedback-toggle active" data-value="feature">Feature</button>
              <button type="button" class="feedback-toggle" data-value="bug">Bug</button>
              <button type="button" class="feedback-toggle" data-value="idea">Idea</button>
              <button type="button" class="feedback-toggle" data-value="other">Other</button>
            </div>
            <textarea id="feedbackMessage" class="feedback-message" placeholder="Tell us what's on your mind..." rows="3"></textarea>
            <div class="feedback-actions">
              <button id="sendFeedback" class="feedback-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="22" y1="2" x2="11" y2="13"/>
                  <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                </svg>
                Send Feedback
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button id="appSettingsSave">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- Confirm Dialog -->
  <div id="confirmDialog" class="modal-overlay hidden">
    <div class="confirm-dialog">
      <div class="confirm-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="24" height="24" rx="4" fill="#1a1a1a"/>
          <path d="M12 2c4.8 0 8.5 3.7 8.5 8.5 0 2.6-1.1 4.9-2.9 6.5-.5.5-1.2.5-1.7 0-.4-.4-.4-1 0-1.5 1.3-1.2 2.1-2.9 2.1-4.8 0-3.8-3.1-6.9-6.9-6.9-2.5 0-4.6 1.3-5.8 3.3-.3.5-1 .6-1.5.3-.5-.3-.6-1-.3-1.5C4.9 3.6 8.2 2 12 2z" fill="#e0e0e0"/>
          <path d="M6.5 9.5c3.1-1.1 6.4 0 8.2 2.7.6.9 1.7 1.3 2.7.9 0 0-1.5 3.8-6.2 5.2-3.4 1-6.6.1-8.6-1.1 0 0 2.1-.5 3.4-1.7 1.1-1 1.4-2.1 1.6-3.3.1-.9-.3-1.8-1.1-2.4z" fill="#e64a19"/>
          <circle cx="15.2" cy="10.8" r="1.2" fill="#ffeb3b"/>
        </svg>
      </div>
      <h3 id="confirmTitle" class="confirm-title">Delete Timer?</h3>
      <p id="confirmMessage" class="confirm-message">This action cannot be undone.</p>
      <label class="confirm-checkbox-label" id="confirmDontAskContainer">
        <input type="checkbox" id="confirmDontAsk" />
        <span>Don't ask again</span>
      </label>
      <div class="confirm-buttons">
        <button id="confirmCancel" class="secondary">Cancel</button>
        <button id="confirmDeleteBtn" class="danger">Delete</button>
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Help -->
  <div id="shortcutsModal" class="modal-overlay hidden">
    <div class="shortcuts-dialog">
      <div class="shortcuts-header">
        <h3>Keyboard Shortcuts</h3>
        <button class="close-btn" id="shortcutsClose">&times;</button>
      </div>
      <div class="shortcuts-content">
        <div class="shortcuts-section">
          <h4>Timer Controls</h4>
          <div class="shortcut-row"><kbd>Space</kbd><span>Start / Pause / Resume</span></div>
          <div class="shortcut-row"><kbd>R</kbd><span>Reset timer</span></div>
          <div class="shortcut-row"><kbd>F</kbd><span>Flash timer</span></div>
          <div class="shortcut-row"><kbd>B</kbd><span>Toggle blackout</span></div>
        </div>
        <div class="shortcuts-section">
          <h4>Profiles</h4>
          <div class="shortcut-row"><kbd>1</kbd> - <kbd>9</kbd><span>Switch to profile 1-9</span></div>
        </div>
        <div class="shortcuts-section">
          <h4>Output Window</h4>
          <div class="shortcut-row"><kbd>Esc</kbd><span>Toggle fullscreen</span></div>
        </div>
        <div class="shortcuts-section">
          <h4>Editing</h4>
          <div class="shortcut-row"><kbd>⌘/Ctrl</kbd> + <kbd>Z</kbd><span>Undo</span></div>
          <div class="shortcut-row"><kbd>⌘/Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Z</kbd><span>Redo</span></div>
        </div>
        <div class="shortcuts-section">
          <h4>General</h4>
          <div class="shortcut-row"><kbd>?</kbd><span>Show this help</span></div>
        </div>
      </div>
      <div class="shortcuts-footer">
        <span class="shortcuts-hint">Press <kbd>Esc</kbd> or <kbd>?</kbd> to close</span>
      </div>
    </div>
  </div>

  <!-- Onboarding Tutorial -->
  <div id="tutorialOverlay" class="tutorial-overlay hidden">
    <!-- Welcome/Done Modal (steps 1 and 5) -->
    <div id="tutorialModal" class="tutorial-modal" role="dialog" aria-label="Tutorial">
      <div class="tutorial-content">
        <!-- Step 1: Welcome -->
        <div class="tutorial-step" data-step="1">
          <span class="tutorial-step-counter" id="tutorialStepCounter">Step 1 of 5</span>
          <img src="../assets/icons/icon.svg" alt="Ninja Timer" class="tutorial-logo">
          <h2>Welcome to Ninja Timer</h2>
          <p>Professional countdown timers for broadcasts, events, and presentations</p>
          <div class="tutorial-actions">
            <button id="tutorialStart" class="btn primary">Show me around!</button>
            <button id="tutorialSkip" class="btn secondary">No, I'll do it myself</button>
          </div>
          <div class="tutorial-progress">
            <span class="progress-dot" data-step="1"></span>
            <span class="progress-dot" data-step="2"></span>
            <span class="progress-dot" data-step="3"></span>
            <span class="progress-dot" data-step="4"></span>
            <span class="progress-dot" data-step="5"></span>
          </div>
        </div>

        <!-- Step 5: Done -->
        <div class="tutorial-step hidden" data-step="5">
          <span class="tutorial-step-counter">Complete!</span>
          <img src="../assets/icons/icon.svg" alt="Ninja Timer" class="tutorial-logo">
          <h2>You're All Set!</h2>
          <p>Press <kbd>?</kbd> anytime for keyboard shortcuts.</p>
          <p>Click <strong>Output</strong> to open your timer display window.</p>
          <div class="tutorial-actions">
            <button id="tutorialFinish" class="btn primary">Get Started</button>
          </div>
          <div class="tutorial-progress">
            <span class="progress-dot" data-step="1"></span>
            <span class="progress-dot" data-step="2"></span>
            <span class="progress-dot" data-step="3"></span>
            <span class="progress-dot" data-step="4"></span>
            <span class="progress-dot" data-step="5"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Spotlight tooltip (steps 2-4) -->
    <div id="tutorialTooltip" class="tutorial-tooltip hidden">
      <div class="tutorial-tooltip-content">
        <span class="tutorial-step-counter" id="tutorialTooltipCounter">Step 2 of 5</span>
        <p id="tutorialTooltipText"></p>
        <div class="tutorial-tooltip-hint">
          <span class="tutorial-hint-text"><kbd>Esc</kbd> to skip</span>
          <span id="tutorialSkipStep" class="tutorial-skip-link">Skip step</span>
        </div>
      </div>
      <div class="tutorial-tooltip-arrow"></div>
    </div>
  </div>

  <!-- Spotlight highlight (rendered separately for z-index layering) -->
  <div id="tutorialSpotlight" class="tutorial-spotlight hidden"></div>

  <!-- Tutorial success checkmark -->
  <div id="tutorialCheckmark" class="tutorial-checkmark hidden">
    <svg viewBox="0 0 24 24" class="checkmark-svg">
      <circle class="checkmark-circle" cx="12" cy="12" r="10"/>
      <path class="checkmark-check" d="M6 12l4 4 8-8"/>
    </svg>
  </div>

  <!-- Tutorial confetti celebration -->
  <div id="tutorialConfetti" class="tutorial-confetti hidden"></div>

  <footer>
    <small>v1.1.0</small>
  </footer>

  <script type="module" src="control.js"></script>
</body>
</html>
